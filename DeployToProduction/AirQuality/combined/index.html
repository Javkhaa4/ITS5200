<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
  <script src="./combined.js"></script>
  
   <style>
    table, th, td {
      border: 1px solid;
    }

    #leftbox {
      float: left;
      width: 33%;
      height: 300px;
    }

    #middlebox {
      float: left;
      width: 33%;
      height: 300px;
    }

    #rightbox {
      float: right;
      width: 33%;
      height: 300px;
    }

    h1 {
      color: black;
      text-align: center;
    }

     #predictions2 table td#td1 {
      font-size: 20px; /* Adjust the font size as needed */
      padding: 10px;  /* Adjust the padding as needed */
     }
  </style>
</head>
<body>

  <h1> Air Quality Index Calculator </h1>

  <div id="page1">
    <div id="boxes1">
      <input type="text" id="box1" value="96.83"> Particulate Matter 2.5 (PM2.5) <br/>
      <input type="text" id="box2" value="139.36"> articulate Matter 10 (PM10) <br/>
      <input type="text" id="box3" value="1.6"> Nitrogen Monoxide (NO)  <br/>
      <input type="text" id="box4" value="25.65"> Nitrogen Dioxide (NO2) <br/>
      <input type="text" id="box5" value="14.99" > Nitrogen X (NOx) <br/>
      <input type="text" id="box6" value="15.12"> Ammonia (NH3) <br/>
      <input type="text" id="box7" value="0.11"> Carbon Monoxide (CO) <br/>
      <input type="text" id="box8" value="16.54"> Sulfur Dioxide (SO2) <br/>
      <input type="text" id="box9" value="117.21"> Ground-Level Ozone (O3) <br/>
      <input type="text" id="box10" value="0.29" > Benzene <br/>
      <input type="text" id="box11" value="4.45"> Toluene <br/>
      <input type="text" id="box12" value="0.07"> Xylene <br/>
    </div>

    <div>
      <input type="button" value="Calculate" onclick="runExample1()"/>
    </div>

    <div id="predictions1">
      <h2> Air Quality Index </h2>
    </div>
  </div>

  <hr>

  <div id="page2">
    <div id="boxes2">
      <input type="text" id="box1_page2" value=""> AQI value <br/>
    </div>

    <div>
      <input type="button" value="Calculate" onclick="runExample2()"/>
    </div>

    <div id="predictions2">
      <h2> Level of Concern </h2>
    </div>
  </div>

  <script>
    async function runExample1() {
      var x = new Float32Array(12);

      x[0] = parseFloat(document.getElementById('box1').value);
      x[1] = parseFloat(document.getElementById('box2').value);
      x[2] = parseFloat(document.getElementById('box3').value);
      x[3] = parseFloat(document.getElementById('box4').value);
      x[4] = parseFloat(document.getElementById('box5').value);
      x[5] = parseFloat(document.getElementById('box6').value);
      x[6] = parseFloat(document.getElementById('box7').value);
      x[7] = parseFloat(document.getElementById('box8').value);
      x[8] = parseFloat(document.getElementById('box9').value);
      x[9] = parseFloat(document.getElementById('box10').value);
      x[10] = parseFloat(document.getElementById('box11').value);
      x[11] = parseFloat(document.getElementById('box12').value);

      let tensorX = new ort.Tensor('float32', x, [1, 12]);
      let feeds = { float_input: tensorX };

      let session = await ort.InferenceSession.create('xgboost_AirQuality_ort.onnx');
      let result = await session.run(feeds);
      let outputData = parseFloat(result.variable.data).toFixed(2);

      // Show the predicted AQI on the first page
      let predictions1 = document.getElementById('predictions1');
      predictions1.innerHTML = `<hr> Air Quality Index <br/>
        <table>
          <tr>
            <td> AQI </td>
            <td id="td0"> ${outputData} </td>
          </tr>
        </table>`;

      // Automatically populate input on page 2 with predicted AQI from page 1
      document.getElementById('box1_page2').value = outputData;
    }

    
async function runExample2() {
  var x = new Float32Array(1);
  x[0] = parseFloat(document.getElementById('box1_page2').value);

  let tensorX = new ort.Tensor('float32', x, [1, 1]);
  let feeds = { float_input: tensorX };

  let session = await ort.InferenceSession.create('xgboost_Classification_AirQuality_ort.onnx');
  let result = await session.run(feeds);
  let outputData2 = parseFloat(result.variable.data).toFixed(2);

  // Convert to integer for switch case
  let predictionInteger = Math.round(outputData2);

  // Map the predicted number to the corresponding word
  let predictionWord = mapPredictionToWord(predictionInteger);
     
 // Create the td1 element dynamically
  let td1Element = document.createElement('td');
  td1Element.id = 'td1';

  // Update the second predicted value section with the latest prediction in words
  predictions2.innerHTML = `<hr> Level of Concern <br/>
      <table>
        <tr>
          <td> Air Quality: </td>
          <td id="td1"> ${outputData2}, ${predictionWord} </td>
        </tr>
      </table>`;

  // Set the background color based on the prediction
  switch (predictionInteger) {
    case 0:
      td1Element.style.backgroundColor = 'green';
      break;
    case 1:
      td1Element.style.backgroundColor = 'yellow';
      break;
    case 2:
      td1Element.style.backgroundColor = 'orange';
      break;
    case 3:
      td1Element.style.backgroundColor = 'red';
      break;
    case 4:
      td1Element.style.backgroundColor = 'purple';
      break;
    case 5:
      td1Element.style.backgroundColor = 'maroon';
      break;
    default:
      td1Element.style.backgroundColor = 'white'; // Set a default color if prediction is unknown
  }

  // Append the td1 element to the existing table
  let table = predictions2.querySelector('table');
  let tr = document.createElement('tr');
  tr.appendChild(td1Element);
  table.appendChild(tr);


}

function mapPredictionToWord(prediction) {
  const mapping = {
    0: 'Good',
    1: 'Satisfactory',
    2: 'Moderate',
    3: 'Poor',
    4: 'Very Poor',
    5: 'Severe'
  };

  return mapping.hasOwnProperty(prediction) ? mapping[prediction] : 'Unknown';
}

  </script>
</body>
</html>
